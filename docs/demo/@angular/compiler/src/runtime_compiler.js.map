{"version":3,"file":"runtime_compiler.js","sourceRoot":"","sources":["../../../../modules/@angular/compiler/src/runtime_compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Compiler, ComponentFactory, ComponentResolver, Injectable} from '@angular/core';\n\nimport {BaseException} from '../src/facade/exceptions';\nimport {ConcreteType, IS_DART, Type, isBlank, isString, stringify} from '../src/facade/lang';\n\nimport {ListWrapper,} from '../src/facade/collection';\nimport {PromiseWrapper} from '../src/facade/async';\nimport {createHostComponentMeta, CompileDirectiveMetadata, CompilePipeMetadata, CompileIdentifierMetadata} from './compile_metadata';\nimport {TemplateAst,} from './template_ast';\nimport {StyleCompiler, StylesCompileDependency, CompiledStylesheet} from './style_compiler';\nimport {ViewCompiler, ViewCompileResult, ViewFactoryDependency, ComponentFactoryDependency} from './view_compiler/view_compiler';\nimport {TemplateParser} from './template_parser';\nimport {DirectiveNormalizer, NormalizeDirectiveResult} from './directive_normalizer';\nimport {CompileMetadataResolver} from './metadata_resolver';\nimport {CompilerConfig} from './config';\nimport * as ir from './output/output_ast';\nimport {jitStatements} from './output/output_jit';\nimport {interpretStatements} from './output/output_interpreter';\nimport {InterpretiveAppViewInstanceFactory} from './output/interpretive_view';\nexport class RuntimeCompiler implements ComponentResolver, Compiler {\n  private _compiledTemplateCache = new Map<any, CompiledTemplate>();\n  private _compiledHostTemplateCache = new Map<any, CompiledTemplate>();\n\n  constructor(\n      private _metadataResolver: CompileMetadataResolver,\n      private _templateNormalizer: DirectiveNormalizer, private _templateParser: TemplateParser,\n      private _styleCompiler: StyleCompiler, private _viewCompiler: ViewCompiler,\n      private _genConfig: CompilerConfig) {}\n\n  resolveComponent(component: Type|string): Promise<ComponentFactory<any>> {\n    if (isString(component)) {\n      return PromiseWrapper.reject(\n          new BaseException(`Cannot resolve component using '${component}'.`), null);\n    }\n    return this.compileComponentAsync(<ConcreteType<any>>component);\n  }\n\n  compileComponentAsync<T>(compType: ConcreteType<T>): Promise<ComponentFactory<T>> {\n    var templates = this._getTransitiveCompiledTemplates(compType, true);\n    var loadingPromises: Promise<any>[] = [];\n    templates.forEach((template) => {\n      if (template.loading) {\n        loadingPromises.push(template.loading);\n      }\n    });\n    return Promise.all(loadingPromises).then(() => {\n      templates.forEach((template) => { this._compileTemplate(template); });\n      return this._getCompiledHostTemplate(compType).proxyComponentFactory;\n    });\n  }\n\n  compileComponentSync<T>(compType: ConcreteType<T>): ComponentFactory<T> {\n    var templates = this._getTransitiveCompiledTemplates(compType, true);\n    templates.forEach((template) => {\n      if (template.loading) {\n        throw new BaseException(\n            `Can't compile synchronously as ${template.compType.name} is still being loaded!`);\n      }\n    });\n    templates.forEach((template) => { this._compileTemplate(template); });\n    return this._getCompiledHostTemplate(compType).proxyComponentFactory;\n  }\n\n  clearCacheFor(compType: Type) {\n    this._metadataResolver.clearCacheFor(compType);\n    this._compiledHostTemplateCache.delete(compType);\n    var compiledTemplate = this._compiledTemplateCache.get(compType);\n    if (compiledTemplate) {\n      this._templateNormalizer.clearCacheFor(compiledTemplate.normalizedCompMeta);\n      this._compiledTemplateCache.delete(compType);\n    }\n  }\n\n  clearCache(): void {\n    this._metadataResolver.clearCache();\n    this._compiledTemplateCache.clear();\n    this._compiledHostTemplateCache.clear();\n    this._templateNormalizer.clearCache();\n  }\n\n  private _getCompiledHostTemplate(type: Type): CompiledTemplate {\n    var compiledTemplate = this._compiledHostTemplateCache.get(type);\n    if (isBlank(compiledTemplate)) {\n      var compMeta = this._metadataResolver.getDirectiveMetadata(type);\n      assertComponent(compMeta);\n      var hostMeta = createHostComponentMeta(compMeta.type, compMeta.selector);\n      compiledTemplate = new CompiledTemplate(\n          true, compMeta.selector, compMeta.type, [], [type], [], [],\n          this._templateNormalizer.normalizeDirective(hostMeta));\n      this._compiledHostTemplateCache.set(type, compiledTemplate);\n    }\n    return compiledTemplate;\n  }\n\n  private _getCompiledTemplate(type: Type): CompiledTemplate {\n    var compiledTemplate = this._compiledTemplateCache.get(type);\n    if (isBlank(compiledTemplate)) {\n      var compMeta = this._metadataResolver.getDirectiveMetadata(type);\n      assertComponent(compMeta);\n      var viewDirectives: CompileDirectiveMetadata[] = [];\n      var viewComponentTypes: Type[] = [];\n      this._metadataResolver.getViewDirectivesMetadata(type).forEach(dirOrComp => {\n        if (dirOrComp.isComponent) {\n          viewComponentTypes.push(dirOrComp.type.runtime);\n        } else {\n          viewDirectives.push(dirOrComp);\n        }\n      });\n      var precompileComponentTypes = compMeta.precompile.map((typeMeta) => typeMeta.runtime);\n      var pipes = this._metadataResolver.getViewPipesMetadata(type);\n      compiledTemplate = new CompiledTemplate(\n          false, compMeta.selector, compMeta.type, viewDirectives, viewComponentTypes,\n          precompileComponentTypes, pipes, this._templateNormalizer.normalizeDirective(compMeta));\n      this._compiledTemplateCache.set(type, compiledTemplate);\n    }\n    return compiledTemplate;\n  }\n\n  private _getTransitiveCompiledTemplates(\n      compType: Type, isHost: boolean,\n      target: Set<CompiledTemplate> = new Set<CompiledTemplate>()): Set<CompiledTemplate> {\n    var template =\n        isHost ? this._getCompiledHostTemplate(compType) : this._getCompiledTemplate(compType);\n    if (!target.has(template)) {\n      target.add(template);\n      template.viewComponentTypes.forEach(\n          (compType) => { this._getTransitiveCompiledTemplates(compType, false, target); });\n      template.precompileHostComponentTypes.forEach(\n          (compType) => { this._getTransitiveCompiledTemplates(compType, true, target); });\n    }\n    return target;\n  }\n\n  private _compileTemplate(template: CompiledTemplate) {\n    if (template.isCompiled) {\n      return;\n    }\n    var compMeta = template.normalizedCompMeta;\n    var externalStylesheetsByModuleUrl = new Map<string, CompiledStylesheet>();\n    var stylesCompileResult = this._styleCompiler.compileComponent(compMeta);\n    stylesCompileResult.externalStylesheets.forEach(\n        (r) => { externalStylesheetsByModuleUrl.set(r.meta.moduleUrl, r); });\n    this._resolveStylesCompileResult(\n        stylesCompileResult.componentStylesheet, externalStylesheetsByModuleUrl);\n    var viewCompMetas = template.viewComponentTypes.map(\n        (compType) => this._getCompiledTemplate(compType).normalizedCompMeta);\n    var parsedTemplate = this._templateParser.parse(\n        compMeta, compMeta.template.template, template.viewDirectives.concat(viewCompMetas),\n        template.viewPipes, compMeta.type.name);\n    var compileResult = this._viewCompiler.compileComponent(\n        compMeta, parsedTemplate, ir.variable(stylesCompileResult.componentStylesheet.stylesVar),\n        template.viewPipes);\n    var depTemplates = compileResult.dependencies.map((dep) => {\n      let depTemplate: CompiledTemplate;\n      if (dep instanceof ViewFactoryDependency) {\n        let vfd = <ViewFactoryDependency>dep;\n        depTemplate = this._getCompiledTemplate(vfd.comp.runtime);\n        vfd.placeholder.runtime = depTemplate.proxyViewFactory;\n        vfd.placeholder.name = `viewFactory_${vfd.comp.name}`;\n      } else if (dep instanceof ComponentFactoryDependency) {\n        let cfd = <ComponentFactoryDependency>dep;\n        depTemplate = this._getCompiledHostTemplate(cfd.comp.runtime);\n        cfd.placeholder.runtime = depTemplate.proxyComponentFactory;\n        cfd.placeholder.name = `compFactory_${cfd.comp.name}`;\n      }\n      return depTemplate;\n    });\n    var statements =\n        stylesCompileResult.componentStylesheet.statements.concat(compileResult.statements);\n    var factory: any;\n    if (IS_DART || !this._genConfig.useJit) {\n      factory = interpretStatements(\n          statements, compileResult.viewFactoryVar, new InterpretiveAppViewInstanceFactory());\n    } else {\n      factory = jitStatements(\n          `${template.compType.name}.template.js`, statements, compileResult.viewFactoryVar);\n    }\n    template.compiled(factory);\n  }\n\n  private _resolveStylesCompileResult(\n      result: CompiledStylesheet, externalStylesheetsByModuleUrl: Map<string, CompiledStylesheet>) {\n    result.dependencies.forEach((dep, i) => {\n      var nestedCompileResult = externalStylesheetsByModuleUrl.get(dep.moduleUrl);\n      var nestedStylesArr = this._resolveAndEvalStylesCompileResult(\n          nestedCompileResult, externalStylesheetsByModuleUrl);\n      dep.valuePlaceholder.runtime = nestedStylesArr;\n      dep.valuePlaceholder.name = `importedStyles${i}`;\n    });\n  }\n\n  private _resolveAndEvalStylesCompileResult(\n      result: CompiledStylesheet,\n      externalStylesheetsByModuleUrl: Map<string, CompiledStylesheet>): string[] {\n    this._resolveStylesCompileResult(result, externalStylesheetsByModuleUrl);\n    if (IS_DART || !this._genConfig.useJit) {\n      return interpretStatements(\n          result.statements, result.stylesVar, new InterpretiveAppViewInstanceFactory());\n    } else {\n      return jitStatements(`${result.meta.moduleUrl}.css.js`, result.statements, result.stylesVar);\n    }\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n{type: CompileMetadataResolver, },\n{type: DirectiveNormalizer, },\n{type: TemplateParser, },\n{type: StyleCompiler, },\n{type: ViewCompiler, },\n{type: CompilerConfig, },\n];\n}\n\nclass CompiledTemplate {\n  private _viewFactory: Function = null;\n  proxyViewFactory: Function;\n  proxyComponentFactory: ComponentFactory<any>;\n  loading: Promise<any> = null;\n  private _normalizedCompMeta: CompileDirectiveMetadata = null;\n  isCompiled = false;\n  isCompiledWithDeps = false;\n\n  constructor(\n      public isHost: boolean, selector: string, public compType: CompileIdentifierMetadata,\n      public viewDirectives: CompileDirectiveMetadata[], public viewComponentTypes: Type[],\n      public precompileHostComponentTypes: Type[], public viewPipes: CompilePipeMetadata[],\n      private _normalizeResult: NormalizeDirectiveResult) {\n    this.proxyViewFactory = (...args: any[]) => this._viewFactory.apply(null, args);\n    this.proxyComponentFactory = isHost ?\n        new ComponentFactory<any>(selector, this.proxyViewFactory, compType.runtime) :\n        null;\n    if (_normalizeResult.syncResult) {\n      this._normalizedCompMeta = _normalizeResult.syncResult;\n    } else {\n      this.loading = _normalizeResult.asyncResult.then((normalizedCompMeta) => {\n        this._normalizedCompMeta = normalizedCompMeta;\n        this.loading = null;\n      });\n    }\n  }\n\n  get normalizedCompMeta(): CompileDirectiveMetadata {\n    if (this.loading) {\n      throw new BaseException(`Template is still loading for ${this.compType.name}!`);\n    }\n    return this._normalizedCompMeta;\n  }\n\n  compiled(viewFactory: Function) {\n    this._viewFactory = viewFactory;\n    this.isCompiled = true;\n  }\n\n  depsCompiled() { this.isCompiledWithDeps = true; }\n}\n\nfunction assertComponent(meta: CompileDirectiveMetadata) {\n  if (!meta.isComponent) {\n    throw new BaseException(`Could not compile '${meta.type.name}' because it is not a component.`);\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}