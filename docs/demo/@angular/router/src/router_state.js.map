{"version":3,"file":"router_state.js","sourceRoot":"","sources":["../../../../modules/@angular/router/src/router_state.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ComponentFactory, Type} from '@angular/core';\nimport {BehaviorSubject} from 'rxjs/BehaviorSubject';\nimport {Observable} from 'rxjs/Observable';\n\nimport {Data, ResolveData, Route} from './config';\nimport {PRIMARY_OUTLET, Params} from './shared';\nimport {UrlPathWithParams, UrlSegment, UrlTree} from './url_tree';\nimport {merge, shallowEqual, shallowEqualArrays} from './utils/collection';\nimport {Tree, TreeNode} from './utils/tree';\n\n\n/**\n * The state of the router.\n *\n * ### Usage\n *\n * ```\n * class MyComponent {\n *   constructor(router: Router) {\n *     const state = router.routerState;\n *     const id: Observable<string> = state.firstChild(state.root).params.map(p => p.id);\n *     const isDebug: Observable<string> = state.queryParams.map(q => q.debug);\n *   }\n * }\n * ```\n *\n * @stable\n */\nexport class RouterState extends Tree<ActivatedRoute> {\n  /**\n   * @internal\n   */\n  constructor(\n      root: TreeNode<ActivatedRoute>, public queryParams: Observable<Params>,\n      public fragment: Observable<string>, public snapshot: RouterStateSnapshot) {\n    super(root);\n  }\n\n  toString(): string { return this.snapshot.toString(); }\n}\n\nexport function createEmptyState(urlTree: UrlTree, rootComponent: Type): RouterState {\n  const snapshot = createEmptyStateSnapshot(urlTree, rootComponent);\n  const emptyUrl = new BehaviorSubject([new UrlPathWithParams('', {})]);\n  const emptyParams = new BehaviorSubject({});\n  const emptyData = new BehaviorSubject({});\n  const emptyQueryParams = new BehaviorSubject({});\n  const fragment = new BehaviorSubject('');\n  const activated = new ActivatedRoute(\n      emptyUrl, emptyParams, emptyData, PRIMARY_OUTLET, rootComponent, snapshot.root);\n  activated.snapshot = snapshot.root;\n  return new RouterState(\n      new TreeNode<ActivatedRoute>(activated, []), emptyQueryParams, fragment, snapshot);\n}\n\nfunction createEmptyStateSnapshot(urlTree: UrlTree, rootComponent: Type): RouterStateSnapshot {\n  const emptyParams = {};\n  const emptyData = {};\n  const emptyQueryParams = {};\n  const fragment = '';\n  const activated = new ActivatedRouteSnapshot(\n      [], emptyParams, emptyData, PRIMARY_OUTLET, rootComponent, null, urlTree.root, -1,\n      InheritedResolve.empty);\n  return new RouterStateSnapshot(\n      '', new TreeNode<ActivatedRouteSnapshot>(activated, []), emptyQueryParams, fragment);\n}\n\n/**\n * Contains the information about a component loaded in an outlet. The information is provided\n * through the params, urlSegments, and data observables.\n *\n * ### Usage\n *\n * ```\n * class MyComponent {\n *   constructor(route: ActivatedRoute) {\n *     const id: Observable<string> = route.params.map(p => p.id);\n *     const data = route.data.map(d => d.user); //includes `data` and `resolve`\n *   }\n * }\n * ```\n *\n * @stable\n */\nexport class ActivatedRoute {\n  /** @internal */\n  _futureSnapshot: ActivatedRouteSnapshot;\n  snapshot: ActivatedRouteSnapshot;\n\n  /**\n   * @internal\n   */\n  constructor(\n      public url: Observable<UrlPathWithParams[]>, public params: Observable<Params>,\n      public data: Observable<Data>, public outlet: string, public component: Type|string,\n      futureSnapshot: ActivatedRouteSnapshot) {\n    this._futureSnapshot = futureSnapshot;\n  }\n\n  toString(): string {\n    return this.snapshot ? this.snapshot.toString() : `Future(${this._futureSnapshot})`;\n  }\n}\n\n/**\n * @internal\n */\nexport class InheritedResolve {\n  /**\n   * @internal\n   */\n  resolvedData = {};\n\n  constructor(public parent: InheritedResolve, public current: ResolveData) {}\n\n  /**\n   * @internal\n   */\n  get flattenedResolvedData(): Data {\n    return this.parent ? merge(this.parent.flattenedResolvedData, this.resolvedData) :\n                         this.resolvedData;\n  }\n\n  static get empty(): InheritedResolve { return new InheritedResolve(null, {}); }\n}\n\n/**\n * Contains the information about a component loaded in an outlet at a particular moment in time.\n *\n * ### Usage\n *\n * ```\n * class MyComponent {\n *   constructor(route: ActivatedRoute) {\n *     const id: string = route.snapshot.params.id;\n *     const data = route.snapshot.data;\n *   }\n * }\n * ```\n *\n * @stable\n */\nexport class ActivatedRouteSnapshot {\n  /**\n   * @internal\n   */\n  _resolvedComponentFactory: ComponentFactory<any>;\n\n  /** @internal **/\n  _routeConfig: Route;\n\n  /** @internal **/\n  _urlSegment: UrlSegment;\n\n  /** @internal */\n  _lastPathIndex: number;\n\n  /** @internal */\n  _resolve: InheritedResolve;\n\n  /**\n   * @internal\n   */\n  constructor(\n      public url: UrlPathWithParams[], public params: Params, public data: Data,\n      public outlet: string, public component: Type|string, routeConfig: Route,\n      urlSegment: UrlSegment, lastPathIndex: number, resolve: InheritedResolve) {\n    this._routeConfig = routeConfig;\n    this._urlSegment = urlSegment;\n    this._lastPathIndex = lastPathIndex;\n    this._resolve = resolve;\n  }\n\n  toString(): string {\n    const url = this.url.map(s => s.toString()).join('/');\n    const matched = this._routeConfig ? this._routeConfig.path : '';\n    return `Route(url:'${url}', path:'${matched}')`;\n  }\n}\n\n/**\n * The state of the router at a particular moment in time.\n *\n * ### Usage\n *\n * ```\n * class MyComponent {\n *   constructor(router: Router) {\n *     const snapshot = router.routerState.snapshot;\n *   }\n * }\n * ```\n *\n * @stable\n */\nexport class RouterStateSnapshot extends Tree<ActivatedRouteSnapshot> {\n  /**\n   * @internal\n   */\n  constructor(\n      public url: string, root: TreeNode<ActivatedRouteSnapshot>, public queryParams: Params,\n      public fragment: string) {\n    super(root);\n  }\n\n  toString(): string { return serializeNode(this._root); }\n}\n\nfunction serializeNode(node: TreeNode<ActivatedRouteSnapshot>): string {\n  const c = node.children.length > 0 ? ` { ${node.children.map(serializeNode).join(\", \")} } ` : '';\n  return `${node.value}${c}`;\n}\n\n\n/**\n * The expectation is that the activate route is created with the right set of parameters.\n * So we push new values into the observables only when they are not the initial values.\n * And we detect that by checking if the snapshot field is set.\n */\nexport function advanceActivatedRoute(route: ActivatedRoute): void {\n  if (route.snapshot) {\n    if (!shallowEqual(route.snapshot.params, route._futureSnapshot.params)) {\n      (<any>route.params).next(route._futureSnapshot.params);\n      (<any>route.data).next(route._futureSnapshot.data);\n    }\n    if (!shallowEqualArrays(route.snapshot.url, route._futureSnapshot.url)) {\n      (<any>route.url).next(route._futureSnapshot.url);\n    }\n    route.snapshot = route._futureSnapshot;\n  } else {\n    route.snapshot = route._futureSnapshot;\n    (<any>route.data).next(route._futureSnapshot.data);\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}